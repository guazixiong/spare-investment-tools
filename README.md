# 闲钱投资分配计算器 💰

<div align="center">

![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)
![Flask](https://img.shields.io/badge/Flask-2.3.0-green.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

一款帮助个人投资者自动计算闲置资金分配方案的智能工具

[项目简介](#项目简介) • [适用场景](#适用场景) • [快速开始](#快速开始) • [使用指南](#使用指南) • [API文档](#api文档) • [配置说明](#配置说明)

</div>

---

## 📖 项目简介

**闲钱投资分配计算器** 是一款面向个人投资者的智能资金管理工具。它根据您设定的投资策略，自动计算如何将闲置资金分配到不同的投资品类中，包括基金组合、银行固收产品、实体黄金和备用金等。

### 核心功能

- **智能缺口计算**：根据目标生活费、当前余额和负债，自动计算生活费缺口
- **可投资金额计算**：基于新增收入和生活费缺口，确定可用于投资的资金
- **自动资产配置**：按照预设的投资策略比例，将资金分配到不同投资品类
- **定投计划生成**：自动生成每周二、周四的定投计划
- **持仓分析**：根据当前持仓数据，提供加仓和止盈建议

---

## 🎯 适用场景

本工具适用于以下情况：

1. **每月发薪后**：帮助您规划如何将工资收入分配到生活费和投资
2. **有闲置资金时**：当您有一笔额外收入（奖金、投资收益等）需要规划时
3. **定期投资调整**：根据市场变化和持仓情况，调整投资策略

### 典型使用场景示例

**场景：每月工资规划**
- 您的目标生活费：15,000元/月
- 当前生活费账户余额：10,000元
- 本月信用卡待还款：2,000元
- 本月工资收入：20,000元

**工具将帮您计算：**
1. 生活费缺口：5,000元（需要补足的部分）
2. 可投资金额：13,000元（扣除生活费缺口后的闲置资金）
3. 资金分配方案：按30%/60%/5%/5%比例分配到基金/银行固收/黄金/备用金
4. 基金细分：基金组合内的40%/30%/15%/15%详细分配
5. 定投计划：每周二和周四的定投金额建议

---

## 🚀 快速开始

### 环境要求

- **Python**：3.8 或更高版本
- **包管理器**：pip
- **操作系统**：Windows、macOS 或 Linux

### 安装步骤

#### 1. 下载项目

```bash
# 克隆仓库到本地
git clone https://github.com/your-username/spare-investment-tools.git

# 进入项目目录
cd spare-investment-tools
```

#### 2. 安装依赖

```bash
# 安装项目所需的 Python 包
pip install -r requirements.txt
```

#### 3. 启动应用

```bash
# 运行启动脚本
python run.py
```

#### 4. 访问应用

启动成功后，打开浏览器访问：
```
http://localhost:5000
```

---

## 📚 使用指南

### 方式一：Web 界面（推荐）

#### 步骤 1：输入财务数据

在 Web 界面中填写以下信息：

| 字段名 | 说明 | 示例值 |
|--------|------|--------|
| 目标生活费 | 您每月计划的生活费金额 | 15,000 元 |
| 当前生活费余额 | 当前生活费账户中的可用余额 | 10,000 元 |
| 当前负债 | 待还的信用卡或其他负债 | 2,000 元 |
| 新增收入 | 本月新获得的收入（工资、奖金等） | 20,000 元 |

#### 步骤 2：（可选）添加持仓数据

如果您已有基金持仓，可以添加以下信息获取加仓/止盈建议：

| 字段名 | 说明 | 示例值 |
|--------|------|--------|
| 基金名称 | 您持有的基金类型 | 红利低波/沪深300 |
| 持仓成本 | 您购买时的基金净值 | 1.00 元 |
| 当前净值 | 基金当前的净值 | 0.92 元 |
| 持仓金额 | 您投入的总金额 | 10,000 元 |

#### 步骤 3：查看计算结果

点击"计算投资方案"按钮，系统将显示：

1. **资金概况**：生活费缺口、可投资金额
2. **资产配置方案**：四大类投资品类的具体分配金额
3. **基金组合详情**：基金组合内各类基金的分配金额
4. **定投计划**：每周二、周四的定投金额建议
5. **持仓建议**：（如果提供了持仓数据）加仓或止盈建议

### 方式二：API 接口

#### 基础计算

```python
import requests

# 发送计算请求
response = requests.post('http://localhost:5000/api/calculate', json={
    "target_living_expense": 15000,    # 目标生活费
    "current_living_expense": 10000,   # 当前生活费余额
    "debt": 2000,                      # 当前负债
    "new_income": 20000                # 新增收入
})

# 解析响应
result = response.json()
if result['success']:
    data = result['data']
    print(f"生活费缺口: {data['living_expense_gap']} 元")
    print(f"可投资金额: {data['investable_amount']} 元")
    print(f"资产配置: {data['framework_allocation']}")
```

#### 带持仓数据的计算

```python
import requests

response = requests.post('http://localhost:5000/api/calculate', json={
    "target_living_expense": 15000,
    "current_living_expense": 10000,
    "debt": 2000,
    "new_income": 20000,
    "holdings": [                      # 可选：添加持仓数据
        {
            "fund_name": "红利低波/沪深300",
            "holding_cost": 1.0,
            "current_nav": 0.92,
            "holding_amount": 10000
        }
    ]
})

result = response.json()
if result['success']:
    # 查看投资建议
    if 'suggestions' in result['data']:
        print(f"投资建议: {result['data']['suggestions']}")
```

---

## 📊 计算结果示例

### 输入数据

```
目标生活费：15,000 元
当前生活费余额：10,000 元
当前负债：2,000 元
新增收入：20,000 元
```

### 输出结果

```json
{
  "living_expense_gap": 5000.00,
  "investable_amount": 13000.00,
  "framework_allocation": {
    "基金组合": 3900.00,
    "银行固收R2": 7800.00,
    "实体黄金": 650.00,
    "备用金": 650.00
  },
  "fund_allocation": {
    "中短债基金": 1560.00,
    "红利低波/沪深300": 1170.00,
    "标普/纳指": 585.00,
    "黄金ETF联接C": 585.00
  },
  "regular_investment_plan": {
    "tuesday_amount": 585.00,
    "thursday_amount": 3315.00,
    "weekly_total": 3900.00
  }
}
```

**结果解读：**
- **生活费缺口 5,000元**：需要从新增收入中预留 5,000元 用于补足生活费
- **可投资金额 13,000元**：扣除生活费缺口后，可用于投资的资金
- **资产配置**：
  - 3,900元（30%）投入基金组合
  - 7,800元（60%）投入银行固收R2产品
  - 650元（5%）购买实体黄金
  - 650元（5%）作为备用金
- **定投计划**：每周二定投 585元，每周四定投 3,315元

---

## 📁 项目结构

```
spare-investment-tools/
├── src/                      # 后端源代码
│   ├── __init__.py          # Python模块初始化文件
│   ├── app.py               # Flask Web应用主程序
│   ├── calculator.py        # 核心投资计算逻辑
│   └── config.py            # 投资策略配置文件
├── static/                   # 前端静态资源
│   ├── index.html           # Web界面主页面
│   ├── css/                 # 样式文件目录
│   │   └── style.css        # 界面样式表
│   └── js/                  # JavaScript文件目录
│       └── app.js           # 前端交互逻辑
├── run.py                    # 应用启动脚本
├── requirements.txt          # Python依赖包列表
├── .gitignore               # Git版本控制忽略文件
└── README.md                # 项目说明文档（本文件）
```

---

## 🔧 配置说明

所有投资策略配置都在 `src/config.py` 文件中定义，您可以根据个人偏好进行修改。

### 1. 资产配置比例（四大类）

决定了可投资金额如何在四大品类间分配：

| 投资品类 | 比例 | 说明 |
|----------|------|------|
| 基金组合 | 30% | 股票型、混合型等基金投资 |
| 银行固收R2 | 60% | 风险等级R2的银行理财产品 |
| 实体黄金 | 5% | 实物黄金或黄金积存 |
| 备用金 | 5% | 保持流动性的应急资金 |

### 2. 基金组合内部分配

决定了"基金组合"部分如何细分：

| 基金类型 | 比例 | 风险等级 | 特点 |
|----------|------|----------|------|
| 中短债基金 | 40% | 低风险 | 稳健收益，波动小 |
| 红利低波/沪深300 | 30% | 中风险 | 追踪大盘，分红稳定 |
| 标普/纳指 | 15% | 中高风险 | 美股指数，分散风险 |
| 黄金ETF联接C | 15% | 中风险 | 黄金投资，避险资产 |

### 3. 智能交易规则

#### 加仓规则（逢低买入）

当基金净值下跌时，建议加仓比例：

| 跌幅 | 建议加仓比例 | 说明 |
|------|-------------|------|
| 5% | 10% | 小幅下跌，适量加仓 |
| 10% | 15% | 中等下跌，增加仓位 |
| 15% | 20% | 大幅下跌，积极加仓 |

> **注意**：中短债基金不参与加仓规则

#### 止盈规则（获利了结）

当基金收益达到目标时，建议卖出比例：

| 收益率 | 建议卖出比例 | 说明 |
|--------|-------------|------|
| ≥ 30% | 20% | 达到目标收益，部分获利了结 |

> **注意**：中短债基金不参与止盈规则

---

## 📡 API 文档

### 1. 获取配置信息

**请求方式：** `GET`

**请求地址：** `/api/config`

**功能说明：** 获取当前的投资策略配置，包括资产配置比例、基金组合比例、交易规则等。

**响应示例：**

```json
{
  "success": true,
  "data": {
    "framework": {
      "基金组合": 0.3,
      "银行固收R2": 0.6,
      "实体黄金": 0.05,
      "备用金": 0.05
    },
    "fund_portfolio": {
      "中短债基金": 0.4,
      "红利低波/沪深300": 0.3,
      "标普/纳指": 0.15,
      "黄金ETF联接C": 0.15
    },
    "add_position_rules": {
      "跌5%": 0.1,
      "跌10%": 0.15,
      "跌15%": 0.2
    },
    "take_profit": {
      "收益≥30%": 0.2
    }
  }
}
```

---

### 2. 计算投资方案

**请求方式：** `POST`

**请求地址：** `/api/calculate`

**功能说明：** 根据财务数据计算投资方案，支持可选的持仓数据分析。

**请求参数：**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| target_living_expense | number | 是 | 目标生活费金额（元） |
| current_living_expense | number | 是 | 当前生活费余额（元） |
| debt | number | 是 | 当前负债金额（元） |
| new_income | number | 是 | 新增收入金额（元） |
| holdings | array | 否 | 持仓数据数组，用于生成投资建议 |

**holdings 数组元素：**

| 参数名 | 类型 | 说明 |
|--------|------|------|
| fund_name | string | 基金类型名称（需与配置中一致） |
| holding_cost | number | 持仓成本（购买时的净值） |
| current_nav | number | 当前基金净值 |
| holding_amount | number | 持仓金额（元） |

**请求示例：**

```json
{
  "target_living_expense": 15000,
  "current_living_expense": 10000,
  "debt": 2000,
  "new_income": 20000,
  "holdings": [
    {
      "fund_name": "红利低波/沪深300",
      "holding_cost": 1.0,
      "current_nav": 0.92,
      "holding_amount": 10000
    }
  ]
}
```

**响应示例（成功）：**

```json
{
  "success": true,
  "data": {
    "living_expense_gap": 5000.00,
    "investable_amount": 13000.00,
    "framework_allocation": {
      "基金组合": 3900.00,
      "银行固收R2": 7800.00,
      "实体黄金": 650.00,
      "备用金": 650.00
    },
    "fund_allocation": {
      "中短债基金": 1560.00,
      "红利低波/沪深300": 1170.00,
      "标普/纳指": 585.00,
      "黄金ETF联接C": 585.00
    },
    "regular_investment_plan": {
      "tuesday_amount": 585.00,
      "thursday_amount": 3315.00,
      "weekly_total": 3900.00
    },
    "suggestions": {
      "加仓建议": [...],
      "止盈建议": [...]
    }
  }
}
```

**响应示例（失败）：**

```json
{
  "success": false,
  "error": "可投资金额不足"
}
```

---

## ⚙️ 技术栈

- **后端框架**：Python 3.11 + Flask 2.3
  - Flask：轻量级 Web 框架
  - Flask-CORS：处理跨域请求
  
- **前端技术**：HTML5 + CSS3 + JavaScript
  - 响应式设计，支持移动端访问
  - 无需额外前端框架，轻量快速

---

## ⚠️ 使用注意事项

1. **金额单位**：所有金额均为人民币（元），系统自动保留两位小数

2. **可投资金额**：当计算结果 ≤ 0 时，系统会显示警告信息，建议优先补足生活费缺口

3. **交易规则适用范围**：
   - 加仓和止盈建议仅适用于：红利低波/沪深300、标普/纳指、黄金ETF
   - **中短债基金不参与**自动交易规则（因其波动较小）

4. **投资建议仅供参考**：本工具基于预设规则生成建议，不构成投资建议。实际投资请根据个人风险承受能力谨慎决策。

5. **数据安全**：所有计算在本地完成，不会上传任何个人财务数据到服务器。

---

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request 来帮助改进项目！

### 提交 Issue

如果您发现 bug 或有功能建议，请：
1. 检查是否已有类似 Issue
2. 新建 Issue 并详细描述问题或建议

### 提交代码

1. **Fork** 本仓库到您的 GitHub 账号
2. **创建分支**：`git checkout -b feature/您的功能名称`
3. **提交更改**：`git commit -m '添加：功能描述'`
4. **推送分支**：`git push origin feature/您的功能名称`
5. **创建 Pull Request**：在 GitHub 上提交 PR

### 代码规范

- 遵循 PEP 8 Python 代码规范
- 添加必要的注释和文档字符串
- 保持代码简洁清晰

---

## 📄 开源协议

本项目采用 [MIT 协议](LICENSE) 开源。

---

<div align="center">

**如果这个项目对您有帮助，请给个 ⭐️ 支持一下！**

有问题或建议？欢迎提交 [Issue](https://github.com/your-username/spare-investment-tools/issues)

Made with ❤️ by [Your Name]

</div>
